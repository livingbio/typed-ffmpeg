<h3 class="section"><a href="#toc-xfade_005fopencl">12.18 xfade_opencl</a></h3>

<p>Cross fade two videos with custom transition effect by using OpenCL.
</p>
<p>It accepts the following options:
</p>
<dl compact="compact">
<dt><samp>transition</samp></dt>
<dd><p>Set one of possible transition effects.
</p>
<dl compact="compact">
<dt><samp>custom</samp></dt>
<dd><p>Select custom transition effect, the actual transition description
will be picked from source and kernel options.
</p>
</dd>
<dt><samp>fade</samp></dt>
<dt><samp>wipeleft</samp></dt>
<dt><samp>wiperight</samp></dt>
<dt><samp>wipeup</samp></dt>
<dt><samp>wipedown</samp></dt>
<dt><samp>slideleft</samp></dt>
<dt><samp>slideright</samp></dt>
<dt><samp>slideup</samp></dt>
<dt><samp>slidedown</samp></dt>
<dd>
<p>Default transition is fade.
</p></dd>
</dl>

</dd>
<dt><samp>source</samp></dt>
<dd><p>OpenCL program source file for custom transition.
</p>
</dd>
<dt><samp>kernel</samp></dt>
<dd><p>Set name of kernel to use for custom transition from program source file.
</p>
</dd>
<dt><samp>duration</samp></dt>
<dd><p>Set duration of video transition.
</p>
</dd>
<dt><samp>offset</samp></dt>
<dd><p>Set time of start of transition relative to first video.
</p></dd>
</dl>

<p>The program source file must contain a kernel function with the given name,
which will be run once for each plane of the output.  Each run on a plane
gets enqueued as a separate 2D global NDRange with one work-item for each
pixel to be generated.  The global ID offset for each work-item is therefore
the coordinates of a pixel in the destination image.
</p>
<p>The kernel function needs to take the following arguments:
</p><ul>
<li> Destination image, <var>__write_only image2d_t</var>.

<p>This image will become the output; the kernel should write all of it.
</p>
</li><li> First Source image, <var>__read_only image2d_t</var>.
Second Source image, <var>__read_only image2d_t</var>.

<p>These are the most recent images on each input.  The kernel may read from
them to generate the output, but they can&rsquo;t be written to.
</p>
</li><li> Transition progress, <var>float</var>. This value is always between 0 and 1 inclusive.
</li></ul>

<p>Example programs:
</p>
<ul>
<li> Apply dots curtain transition effect:
<pre class="verbatim">__kernel void blend_images(__write_only image2d_t dst,
                           __read_only  image2d_t src1,
                           __read_only  image2d_t src2,
                           float progress)
{
    const sampler_t sampler = (CLK_NORMALIZED_COORDS_FALSE |
                               CLK_FILTER_LINEAR);
    int2  p = (int2)(get_global_id(0), get_global_id(1));
    float2 rp = (float2)(get_global_id(0), get_global_id(1));
    float2 dim = (float2)(get_image_dim(src1).x, get_image_dim(src1).y);
    rp = rp / dim;

    float2 dots = (float2)(20.0, 20.0);
    float2 center = (float2)(0,0);
    float2 unused;

    float4 val1 = read_imagef(src1, sampler, p);
    float4 val2 = read_imagef(src2, sampler, p);
    bool next = distance(fract(rp * dots, &amp;unused), (float2)(0.5, 0.5)) &lt; (progress / distance(rp, center));

    write_imagef(dst, p, next ? val1 : val2);
}
</pre>
</li></ul>
